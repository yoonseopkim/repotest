aws ssm describe-instance-information \
    --output json \
    --query "InstanceInformationList[*].InstanceId" | \
jq -r '.[]' | \
xargs -I {} aws ec2 describe-instances \
    --instance-ids {} \
    --query "Reservations[*].Instances[*].{
        InstanceId:InstanceId,
        Name:Tags[?Key=='Name'].Value|[0],
        Environment:Tags[?Key=='Environment'].Value|[0],
        Service:Tags[?Key=='Service'].Value|[0]
    }" \
    --output json > instances.json
